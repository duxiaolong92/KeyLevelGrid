# Key Level Grid Strategy 配置 (V2.3 极简版)
# 纯支撑/阻力位网格交易策略

strategy:
  name: "KeyLevelGrid"
  version: "2.3.0"
  description: "基于支撑/阻力位的网格交易策略"

# 运行模式
dry_run: false                    # false = 实盘模式，true = 模拟模式

# 交易配置
trading:
  symbol: "BTCUSDT"           # 币安合约交易对 (Gate 格式: BTC/USDT:USDT)
  exchange: "gate"            # 交易所 (Gate)
  market_type: "futures"      # 合约市场 (USDT 永续)
  margin_mode: "cross"        # 保证金模式: cross (全仓) | isolated (逐仓)
  leverage: 10                 # 杠杆倍数 (建议 3-5x，与 position.max_leverage 保持一致)
  timeframe: "4h"             # 主交易周期
  aux_timeframes:             # 辅助周期 (多周期融合)
    - "1d"

# K线数据源配置
kline_feed:
  history_bars: 500           # 历史K线数量
  update_interval_sec: 5      # 轮询更新间隔
  use_websocket: true         # 使用 WebSocket
  max_retries: 3
  request_timeout_sec: 10.0

# ============================================
# 网格配置 (核心)
# ============================================
grid:
  # 网格区间
  range_mode: "auto"          # auto: 基于 S/R 自动计算 | manual: 手动设置
  manual_upper: 95000        # manual 模式: 上边界
  manual_lower: 87000         # manual 模式: 下边界
  
  # 网格数量
  count_mode: "by_levels"     # by_levels: 按有效支撑位数量 | fixed: 固定数量
  fixed_count: 10              # fixed 模式: 网格数量
  max_grids: 20               # 最大网格数量
  
  # 网格底线 (止损线)
  floor_buffer: 0.005         # 最低支撑下方 0.5%
  
  # 网格重建 (价格大幅偏离锚点时自动重建)
  rebuild_enabled: true       # 是否启用自动重建
  rebuild_threshold_pct: 0.02 # 价格偏离阈值 2%
  rebuild_cooldown_sec: 900   # 重建冷却时间 15分钟 (900秒)

# ============================================
# 仓位配置
# ============================================
position:
  total_capital: 5000         # 账户总金额 (USDT)
  max_leverage: 10            # 最大杠杆 (需与 trading.leverage 保持一致)
  max_capital_usage: 0.8      # 使用 80% 资金，留 20% 缓冲
  
  # 仓位分配
  allocation_mode: "equal"    # equal: 等额分配 | weighted: 按强度加权
  # 每档仓位 = (total_capital × max_leverage × max_capital_usage) / 网格数量

# ============================================
# 止损配置 (总仓位止损)
# ============================================
stop_loss:
  mode: "total"               # total: 统一止损 (不对单个网格止损)
  trigger: "grid_floor"       # grid_floor: 跌破网格底线触发 | fixed_pct: 固定比例
  fixed_pct: 0.10             # fixed_pct 模式: 10% 止损

# ============================================
# 止盈配置 (按阻力位)
# ============================================
take_profit:
  mode: "by_resistance"       # by_resistance: 按阻力位止盈 | fixed_pct: 固定比例
  fixed_pct: 0.05             # fixed_pct 模式: 5% 止盈
  # by_resistance 模式: 每个阻力位止盈 = 总持仓 / 有效阻力位数量

# ============================================
# 支撑/阻力位计算
# ============================================
resistance:
  # 强度阈值 (核心参数)
  min_strength: 80            # 只使用 >= 80 分的支撑/阻力位
  
  # 摆动高低点 (三尺度)
  swing_lookbacks:
    - 5                       # 短期
    - 13                      # 中期
    - 34                      # 长期
  
  # 斐波那契比例
  fib_ratios:
    - 0.382
    - 0.5
    - 0.618
    - 1.0
    - 1.618
  
  # 心理关口
  psychological_enabled: true
  
  # 成交量密集区
  volume_profile_enabled: true
  volume_buckets: 50          # 价格分桶数
  volume_top_n: 5             # 取 Top N 成交量节点
  
  # 融合配置
  merge_tolerance: 0.005      # 合并相近价位 0.5%

# ============================================
# 日志配置
# ============================================
logging:
  level: "INFO"
  file: "logs/key_level_grid.log"
  console: true

# 接口配置（仅引用环境变量，不存放真实密钥）
api:
  key_env: "GATE_KLG_API_KEY"
  secret_env: "GATE_KLG_API_SECRET"
  passphrase_env: ""          # 若有子账户/额外口令可填，否则留空

# ============================================
# Telegram 通知配置
# ============================================
telegram:
  # 基础配置（从环境变量读取）
  enabled: true              # 是否启用 Telegram 通知
  bot_token_env: "TG_BOT_TOKEN"
  chat_id_env: "TG_CHAT_ID"
  
  # 通知开关
  notifications:
    # 必要通知（建议开启）
    startup: true             # 启动通知
    shutdown: true            # 停止通知
    error: true               # 错误通知
    order_filled: true        # 成交通知
    
    # 可选通知
    order_placed: false       # 挂单通知（较频繁，建议关闭）
    grid_rebuild: true        # 网格重建通知
    orders_summary: true      # 挂单汇总（启动时发送）
    
    # 风险通知
    risk_warning: true        # 风险预警
    near_stop_loss_pct: 0.02  # 距止损预警阈值 2%
    
    # 汇总通知
    daily_summary: true       # 每日汇总
    daily_summary_time: "20:00"
    
    # 心跳（可选）
    heartbeat: false          # 心跳通知
    heartbeat_interval_hours: 4
