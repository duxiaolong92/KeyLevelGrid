# Key Level Grid Strategy 配置
# 纯支撑/阻力位网格交易策略

strategy:
  name: "KeyLevelGrid"
  version: "2.0.0"
  description: "基于支撑/阻力位的网格交易策略"

# 运行模式
dry_run: false                    # false = 实盘模式，true = 模拟模式

# 交易配置
trading:
  symbol: "BTCUSDT"           # 币安合约交易对 (Gate 格式: BTC/USDT:USDT)
  exchange: "gate"            # 交易所 (Gate)
  market_type: "futures"      # 合约市场 (USDT 永续)
  margin_mode: "cross"        # 保证金模式: cross (全仓) | isolated (逐仓)
  leverage: 10                 # 杠杆倍数
  timeframe: "4h"             # 主交易周期
  aux_timeframes:             # 辅助周期 (多周期融合，最多 2 个，总共支持 1~3 个周期)
    - "1d"
    - "1w"
  default_contract_size: 0.0001  # 合约大小后备值（仅当 API 获取失败时使用，BTC=0.0001）

# K线数据源配置
kline_feed:
  history_bars: 500           # 历史K线数量
  update_interval_sec: 5      # 轮询更新间隔
  use_websocket: true         # 使用 WebSocket
  max_retries: 3
  request_timeout_sec: 10.0

# ============================================
# 网格配置 (核心)
# ============================================
grid:
  # 网格区间
  range_mode: "manual"          # auto: 基于 S/R 自动计算 | manual: 手动设置
  manual_upper: 108000           # manual 模式: 上边界
  manual_lower: 80000           # manual 模式: 下边界
  
  # 网格数量
  count_mode: "by_levels"       # by_levels: 按有效支撑位数量 | fixed: 固定数量
  max_grids: 50                 # 最大网格数量
  
  # 网格底线 (止损线)
  floor_buffer: 0.005           # 最低支撑下方 0.5%
  
  # 核心参数
  sell_quota_ratio: 0.7         # 动态止盈比例
  min_profit_pct: 0.0001        # 均价利润保护阈值
  buy_price_buffer_pct: 0.005   # 买单空间缓冲
  sell_price_buffer_pct: 0.002  # 卖单空间缓冲
  base_amount_per_grid: 0.001   # 标准网格单位（btc数量）
  max_fill_per_level: 3         # 单水位最大补买次数
  base_position_locked: 0.0     # 固定底仓数量（btc数量）
  recon_interval_sec: 30        # Recon 对账周期
  order_action_timeout_sec: 10  # 挂/撤单超时
  restore_state_enabled: true   # 是否从持久化恢复网格

# ============================================
# 仓位配置
# ============================================
position:
  max_capital_usage: 0.8        # 使用 80% 资金，留 20% 缓冲

# ============================================
# 止损配置 (总仓位止损)
# ============================================
stop_loss:
  mode: "total"                 # total: 统一止损 (不对单个网格止损)
  trigger: "grid_floor"         # grid_floor: 跌破网格底线触发 | fixed_pct: 固定比例

# ============================================
# 支撑/阻力位计算 (ResistanceCalculator)
# ============================================
resistance:
  # 强度阈值 (核心参数)
  min_strength: 30              # 只使用 >= 30 分的支撑/阻力位
  
  # 摆动高低点 (三尺度)
  swing_lookbacks:
    - 5                         # 短期
    - 13                        # 中期
    - 34                        # 长期
  
  # 斐波那契比例
  fib_ratios:
    - 0.382
    - 0.5
    - 0.618
    - 1.0
    - 1.618
  
  # 心理关口
  psychological_enabled: true
  
  # 成交量密集区
  volume_profile_enabled: true
  volume_buckets: 50            # 价格分桶数
  volume_top_n: 5               # 取 Top N 成交量节点
  volume_bucket_pct: 0.01       # 价格分桶百分比 1%
  volume_top_pct: 0.20          # Top 20% 成交量区
  
  # 多周期融合
  mtf_boost: 0.30               # 多周期叠加强度提升 30%
  
  # 融合配置
  merge_tolerance: 0.005        # 合并相近价位 0.5%
  
  # 距离过滤
  min_distance_pct: 0.0001      # 最小距离 0.1% (过滤太近的价位)
  max_distance_pct: 0.30        # 最大距离 30% (过滤太远的价位)

# ============================================
# 日志配置
# ============================================
logging:
  level: "DEBUG"
  file: "logs/key_level_grid.log"
  console: true

# 接口配置（仅引用环境变量，不存放真实密钥）
api:
  key_env: "GATE_KLG_API_KEY"
  secret_env: "GATE_KLG_API_SECRET"
  passphrase_env: ""

# ============================================
# Telegram 通知配置
# ============================================
telegram:
  enabled: true
  bot_token_env: "TG_BOT_TOKEN"
  chat_id_env: "TG_CHAT_ID"
  
  notifications:
    # 必要通知
    startup: true
    shutdown: true
    error: true
    order_filled: true
    
    # 可选通知
    order_placed: false
    orders_summary: true
    quota_event: true
    position_flux: true
    order_sync: true
    system_info: true
    system_alert: true
    
    # 风险通知
    risk_warning: true
    near_stop_loss_pct: 0.02
    
    # 汇总通知
    daily_summary: true
    daily_summary_time: "20:00"
    
    # 心跳
    heartbeat: true
    heartbeat_interval_hours: 4
    heartbeat_idle_sec: 3600

    # 静默模式
    silent_mode: true
    merge_fill_window_sec: 5
    min_notify_interval_sec: 5
