# Key Level Grid Strategy é…ç½® (V3.0)
# çº¯æ”¯æ’‘/é˜»åŠ›ä½ç½‘æ ¼äº¤æ˜“ç­–ç•¥
# 
# V3.0 æ–°å¢:
# - å¤šæ—¶é—´æ¡†æ¶ (MTF) æ°´ä½ç”Ÿæˆ
# - è¯„åˆ†é©±åŠ¨çš„ä»“ä½è‡ªåŠ¨ç¼©æ”¾
# - åŸå­æ€§é‡æ„ä¸å‘Šè­¦æ¨¡å¼

strategy:
  name: "KeyLevelGrid"
  version: "3.0.0"
  description: "åŸºäº MTF è¯„åˆ†çš„ç½‘æ ¼äº¤æ˜“ç­–ç•¥"

# è¿è¡Œæ¨¡å¼
dry_run: false                    # false = å®ç›˜æ¨¡å¼ï¼Œtrue = æ¨¡æ‹Ÿæ¨¡å¼

# äº¤æ˜“é…ç½®
trading:
  symbol: "BTCUSDT"           # å¸å®‰åˆçº¦äº¤æ˜“å¯¹ (Gate æ ¼å¼: BTC/USDT:USDT)
  exchange: "gate"            # äº¤æ˜“æ‰€ (Gate)
  market_type: "futures"      # åˆçº¦å¸‚åœº (USDT æ°¸ç»­)
  margin_mode: "cross"        # ä¿è¯é‡‘æ¨¡å¼: cross (å…¨ä»“) | isolated (é€ä»“)
  leverage: 10                # æ æ†å€æ•° (å»ºè®® 3-5xï¼Œä¸ position.max_leverage ä¿æŒä¸€è‡´)
  timeframe: "4h"             # ä¸»äº¤æ˜“å‘¨æœŸ
  aux_timeframes:             # è¾…åŠ©å‘¨æœŸ (å¤šå‘¨æœŸèåˆï¼Œæœ€å¤š 2 ä¸ªï¼Œæ€»å…±æ”¯æŒ 1~3 ä¸ªå‘¨æœŸ)
    - "1d"
    - "1w"                    # ç¤ºä¾‹: ["1d"] æˆ– ["4h", "1d"] æˆ– ["1h"]
  default_contract_size: 0.0001  # åˆçº¦å¤§å°åå¤‡å€¼ï¼ˆä»…å½“ API è·å–å¤±è´¥æ—¶ä½¿ç”¨ï¼ŒBTC=0.0001ï¼‰

# Kçº¿æ•°æ®æºé…ç½®
kline_feed:
  history_bars: 500           # å†å²Kçº¿æ•°é‡
  update_interval_sec: 5      # è½®è¯¢æ›´æ–°é—´éš”
  use_websocket: true         # ä½¿ç”¨ WebSocket
  max_retries: 3
  request_timeout_sec: 10.0

# ============================================
# ç½‘æ ¼é…ç½® (æ ¸å¿ƒ)
# ============================================
grid:
  # ç½‘æ ¼åŒºé—´
  range_mode: "manual"          # auto: åŸºäº S/R è‡ªåŠ¨è®¡ç®— | manual: æ‰‹åŠ¨è®¾ç½®
  manual_upper: 98000        # manual æ¨¡å¼: ä¸Šè¾¹ç•Œ
  manual_lower: 80000         # manual æ¨¡å¼: ä¸‹è¾¹ç•Œ
  
  # ç½‘æ ¼æ•°é‡
  count_mode: "by_levels"     # by_levels: æŒ‰æœ‰æ•ˆæ”¯æ’‘ä½æ•°é‡ | fixed: å›ºå®šæ•°é‡
  # fixed_count: 10              # fixed æ¨¡å¼: ç½‘æ ¼æ•°é‡
  max_grids: 50               # æœ€å¤§ç½‘æ ¼æ•°é‡
  
  # ç½‘æ ¼åº•çº¿ (æ­¢æŸçº¿)
  floor_buffer: 0.005         # æœ€ä½æ”¯æ’‘ä¸‹æ–¹ 0.5%
  
  # Spec2.0 æ ¸å¿ƒå‚æ•°
  sell_quota_ratio: 0.7        # åŠ¨æ€æ­¢ç›ˆæ¯”ä¾‹
  min_profit_pct: 0.0001        # å‡ä»·åˆ©æ¶¦ä¿æŠ¤é˜ˆå€¼
  buy_price_buffer_pct: 0.002   # ä¹°å•ç©ºé—´ç¼“å†²
  sell_price_buffer_pct: 0.002  # å–å•ç©ºé—´ç¼“å†²
  base_amount_per_grid: 0.001   # æ ‡å‡†ç½‘æ ¼å•ä½ï¼ˆbtcæ•°é‡ï¼‰
  max_fill_per_level: 3         # å•æ°´ä½æœ€å¤§è¡¥ä¹°æ¬¡æ•°
  base_position_locked: 0.0    # å›ºå®šåº•ä»“æ•°é‡ï¼ˆbtcæ•°é‡ï¼‰
  recon_interval_sec: 30       # Recon å¯¹è´¦å‘¨æœŸ
  order_action_timeout_sec: 10 # æŒ‚/æ’¤å•è¶…æ—¶
  restore_state_enabled: true  # æ˜¯å¦ä»æŒä¹…åŒ–æ¢å¤ç½‘æ ¼
  
  # ğŸ†• V3.0 é€šç”¨ç²¾åº¦é…ç½® (æ¶ˆé™¤ç¡¬ç¼–ç )
  precision:
    price_tolerance: 0.0001       # ä»·æ ¼åŒ¹é…å®¹å·® (0.01%)
    qty_tolerance: 0.05           # æ•°é‡åŒ¹é…å®¹å·® (5%)
    merge_tolerance: 0.005        # æ°´ä½åˆå¹¶å®¹å·® (0.5%)
    snap_tolerance: 0.01          # å¿ƒç†ä½å¸é™„å®¹å·® (1%)
  
  # ğŸ†• V3.0 æ°´ä½ç”Ÿæˆé…ç½®
  level_generation:
    enabled: false                    # æ˜¯å¦å¯ç”¨ V3.0 æ°´ä½ç”Ÿæˆå¼•æ“ (false åˆ™ä½¿ç”¨æ—§ç‰ˆ ResistanceCalculator)
    
    # ===== å¤šæ—¶é—´æ¡†æ¶ (MTF) é…ç½® =====
    timeframes:                      # æ—¶é—´æ¡†æ¶åˆ—è¡¨ (æŒ‰ä¼˜å…ˆçº§é™åº)
      - "1d"                         # è¶‹åŠ¿å±‚: æ—¥çº¿ç¡®å®šå¤šç©ºç¯å¢ƒ
      - "4h"                         # æˆ˜ç•¥å±‚: ä¸»è¦æ°´ä½æ¥æº
      - "15m"                        # æˆ˜æœ¯å±‚: ç²¾ç»†åŒ–å…¥åœºç‚¹ (ä»…æ›´æ–°è¯„åˆ†ï¼Œä¸è§¦å‘é‡æ„)
    
    # ===== æ–æ³¢é‚£å¥‘åˆ†å½¢æå– =====
    fibonacci_lookback:              # æ–æ³¢é‚£å¥‘å›æº¯å‘¨æœŸ
      - 8                            # çŸ­çº¿: çº¦ 32 å°æ—¶ (4h Ã— 8)
      - 21                           # ä¸­çº¿: çº¦ 3.5 å¤©
      - 55                           # é•¿çº¿: çº¦ 9.2 å¤© (é©¬å…¶è¯ºé˜²çº¿)
    
    # ===== è¯„åˆ†é˜ˆå€¼ =====
    score_thresholds:
      mtf_resonance: 100             # MTF å…±æŒ¯çº§: Final_Score >= 100, ä»“ä½ Ã— 1.5
      strong: 60                     # å¼ºæ”¯æ’‘çº§: Final_Score >= 60, ä»“ä½ Ã— 1.2
      normal: 30                     # åŸºå‡†çº§: Final_Score >= 30, ä»“ä½ Ã— 1.0
      # Final_Score < 30 çš„æ°´ä½ä¸å¼€ä»“
    
    # ===== è¯„åˆ†æƒé‡ =====
    scoring:
      # æ—¶é—´æ¡†æ¶æƒé‡ (å½±å“ base_score)
      timeframe_weights:
        "1d": 1.5                    # è¶‹åŠ¿å±‚æƒé‡
        "4h": 1.0                    # æˆ˜ç•¥å±‚æƒé‡ (åŸºå‡†)
        "15m": 0.6                   # æˆ˜æœ¯å±‚æƒé‡
      
      # å‘¨æœŸåŸºç¡€åˆ† (æ•°å­— key ä¸ä»£ç å…¼å®¹)
      period_scores:
        89: 80
        55: 80                       # é•¿å‘¨æœŸ: æˆ˜ç•¥çº§
        34: 50
        21: 50                       # ä¸­å‘¨æœŸ: æ ¸å¿ƒéœ‡è¡
        13: 20
        8: 20                        # çŸ­å‘¨æœŸ: çµæ•
      
      # æˆäº¤é‡æƒé‡ (W_volume)
      volume_weights:
        hvn: 1.3                     # é«˜æˆäº¤é‡èŠ‚ç‚¹ (HVN)
        normal: 1.0                  # æ™®é€šåŒºåŸŸ
        lvn: 0.6                     # çœŸç©ºåŒº (LVN)
      
      # å¿ƒç†ä½æƒé‡ (W_psychology)
      psychology_weight: 1.2         # å¯¹é½æ–æ³¢é‚£å¥‘/æ•´æ•°ä½æ—¶çš„åŠ æˆ
      
      # è¶‹åŠ¿ç³»æ•° (T_env) - åµŒå¥—æ ¼å¼ä¸ä»£ç å…¼å®¹
      trend_coefficients:
        bullish:
          support: 1.1               # å¤šå¤´å¸‚åœºåšå¤šæ”¯æ’‘
          resistance: 0.9
        bearish:
          support: 0.9
          resistance: 1.1            # ç©ºå¤´å¸‚åœºåšç©ºé˜»åŠ›
        neutral:
          support: 1.0
          resistance: 1.0
      
      # MTF å…±æŒ¯ç³»æ•° (M_mtf)
      mtf_resonance:
        "1d,4h,15m": 2.0             # ä¸‰æ¡†æ¶å…±æŒ¯
        "1d,4h": 1.5                 # è¶‹åŠ¿+æˆ˜ç•¥
        "1d,15m": 1.3                # è¶‹åŠ¿+æˆ˜æœ¯
        "4h,15m": 1.2                # æˆ˜ç•¥+æˆ˜æœ¯
      
      # è¯„åˆ†é˜ˆå€¼
      min_score_threshold: 30        # æ°´ä½æœ€ä½è¯„åˆ†é˜ˆå€¼ (ä½äºæ­¤åˆ†ä¸ç”Ÿæˆæ°´ä½)
    
    # ===== é‡æ„è§¦å‘é…ç½® =====
    rebuild:
      anchor_drift_threshold: 0.03   # é”šç‚¹åç§»é˜ˆå€¼ (ç»å¯¹å€¼): 3%
      cooldown_sec: 14400            # é‡æ„å†·å†»æœŸ: 4 å°æ—¶ (ç§’)
      max_logs: 100                  # æœ€å¤§é‡æ„æ—¥å¿—æ•°é‡
    
    # ===== è¯„åˆ†åˆ·æ–°é…ç½® (ä¸è§¦å‘æ’¤æŒ‚å•) =====
    score_refresh:
      "4h": 900                      # æˆ˜ç•¥å±‚åˆ·æ–°é—´éš”: 15 åˆ†é’Ÿ (ç§’)
      "15m": 300                     # æˆ˜æœ¯å±‚åˆ·æ–°é—´éš”: 5 åˆ†é’Ÿ (ç§’)
    
    # ===== æ‰‹åŠ¨è¾¹ç•Œ (å¯é€‰) =====
    manual_boundary:
      enabled: false                 # æ˜¯å¦å¯ç”¨æ‰‹åŠ¨è¾¹ç•Œ
      upper_price: null              # æ‰‹åŠ¨ä¸Šè¾¹ç•Œ (é˜»åŠ›ä½)
      lower_price: null              # æ‰‹åŠ¨ä¸‹è¾¹ç•Œ (æ”¯æ’‘ä½)
    
    # ===== K çº¿åŒæ­¥é…ç½® =====
    kline_sync:
      max_lag_sec:                   # æœ€å¤§å…è®¸å»¶è¿Ÿ (ç§’)
        "1d": 300                    # æ—¥çº¿: 5 åˆ†é’Ÿ
        "4h": 60                     # 4h: 1 åˆ†é’Ÿ
        "15m": 30                    # 15m: 30 ç§’

# ============================================
# ä»“ä½é…ç½®
# ============================================
position:
  # total_capital: è‡ªåŠ¨ä»äº¤æ˜“æ‰€è¯»å–ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
  max_leverage: 10            # æœ€å¤§æ æ† (éœ€ä¸ trading.leverage ä¿æŒä¸€è‡´)
  max_capital_usage: 0.8      # ä½¿ç”¨ 80% èµ„é‡‘ï¼Œç•™ 20% ç¼“å†²
  
  # Spec2.0ï¼šå¤´å¯¸ç”± Recon/Event æ§åˆ¶ï¼Œä»“ä½åˆ†é…ä¸å†ä½¿ç”¨

# ============================================
# æ­¢æŸé…ç½® (æ€»ä»“ä½æ­¢æŸ)
# ============================================
stop_loss:
  mode: "total"               # total: ç»Ÿä¸€æ­¢æŸ (ä¸å¯¹å•ä¸ªç½‘æ ¼æ­¢æŸ)
  trigger: "grid_floor"       # grid_floor: è·Œç ´ç½‘æ ¼åº•çº¿è§¦å‘ | fixed_pct: å›ºå®šæ¯”ä¾‹
  # fixed_pct: 0.10             # fixed_pct æ¨¡å¼: 10% æ­¢æŸ



# ============================================
# æ”¯æ’‘/é˜»åŠ›ä½è®¡ç®—
# ============================================
resistance:
  # å¼ºåº¦é˜ˆå€¼ (æ ¸å¿ƒå‚æ•°)
  min_strength: 30            # åªä½¿ç”¨ >= 80 åˆ†çš„æ”¯æ’‘/é˜»åŠ›ä½
  
  # æ‘†åŠ¨é«˜ä½ç‚¹ (ä¸‰å°ºåº¦)
  swing_lookbacks:
    - 5                       # çŸ­æœŸ
    - 13                      # ä¸­æœŸ
    - 34                      # é•¿æœŸ
  
  # æ–æ³¢é‚£å¥‘æ¯”ä¾‹
  fib_ratios:
    - 0.382
    - 0.5
    - 0.618
    - 1.0
    - 1.618
  
  # å¿ƒç†å…³å£
  psychological_enabled: true
  
  # æˆäº¤é‡å¯†é›†åŒº
  volume_profile_enabled: true
  volume_buckets: 50          # ä»·æ ¼åˆ†æ¡¶æ•°
  volume_top_n: 5             # å– Top N æˆäº¤é‡èŠ‚ç‚¹
  volume_bucket_pct: 0.01     # ä»·æ ¼åˆ†æ¡¶ç™¾åˆ†æ¯” 1%
  volume_top_pct: 0.20        # Top 20% æˆäº¤é‡åŒº
  
  # å¤šå‘¨æœŸèåˆ
  mtf_boost: 0.30             # å¤šå‘¨æœŸå åŠ å¼ºåº¦æå‡ 30%
  
  # èåˆé…ç½®
  merge_tolerance: 0.005      # åˆå¹¶ç›¸è¿‘ä»·ä½ 0.5%
  
  # è·ç¦»è¿‡æ»¤
  min_distance_pct: 0.0001     # æœ€å°è·ç¦» 0.1% (è¿‡æ»¤å¤ªè¿‘çš„ä»·ä½)
  max_distance_pct: 0.30      # æœ€å¤§è·ç¦» 30% (è¿‡æ»¤å¤ªè¿œçš„ä»·ä½)

# ============================================
# æ—¥å¿—é…ç½®
# ============================================
logging:
  level: "DEBUG"
  file: "logs/key_level_grid.log"
  console: true

# æ¥å£é…ç½®ï¼ˆä»…å¼•ç”¨ç¯å¢ƒå˜é‡ï¼Œä¸å­˜æ”¾çœŸå®å¯†é’¥ï¼‰
api:
  key_env: "GATE_KLG_API_KEY"
  secret_env: "GATE_KLG_API_SECRET"
  passphrase_env: ""          # è‹¥æœ‰å­è´¦æˆ·/é¢å¤–å£ä»¤å¯å¡«ï¼Œå¦åˆ™ç•™ç©º

# ============================================
# Telegram é€šçŸ¥é…ç½®
# ============================================
telegram:
  # åŸºç¡€é…ç½®ï¼ˆä»ç¯å¢ƒå˜é‡è¯»å–ï¼‰
  enabled: true              # æ˜¯å¦å¯ç”¨ Telegram é€šçŸ¥
  bot_token_env: "TG_BOT_TOKEN"
  chat_id_env: "TG_CHAT_ID"
  
  # é€šçŸ¥å¼€å…³
  notifications:
    # å¿…è¦é€šçŸ¥ï¼ˆå»ºè®®å¼€å¯ï¼‰
    startup: true             # å¯åŠ¨é€šçŸ¥
    shutdown: true            # åœæ­¢é€šçŸ¥
    error: true               # é”™è¯¯é€šçŸ¥
    order_filled: true        # æˆäº¤é€šçŸ¥
    
    # å¯é€‰é€šçŸ¥
    order_placed: false       # æŒ‚å•é€šçŸ¥ï¼ˆè¾ƒé¢‘ç¹ï¼Œå»ºè®®å…³é—­ï¼‰
    orders_summary: true      # æŒ‚å•æ±‡æ€»ï¼ˆå¯åŠ¨æ—¶å‘é€ï¼‰
    quota_event: true         # é…é¢å¯¹é½/æ¸…ç©ºé€šçŸ¥
    position_flux: true       # æŒä»“å˜åŒ–é€šçŸ¥
    order_sync: true          # æŒ‚å•åŒæ­¥æé†’
    system_info: true         # ç³»ç»Ÿæ“ä½œè®°å½•
    system_alert: true        # å…³é”®å‘Šè­¦
    
    # é£é™©é€šçŸ¥
    risk_warning: true        # é£é™©é¢„è­¦
    near_stop_loss_pct: 0.02  # è·æ­¢æŸé¢„è­¦é˜ˆå€¼ 2%
    
    # æ±‡æ€»é€šçŸ¥
    daily_summary: true       # æ¯æ—¥æ±‡æ€»
    daily_summary_time: "20:00"
    
    # å¿ƒè·³ï¼ˆå¯é€‰ï¼‰
    heartbeat: false          # å¿ƒè·³é€šçŸ¥
    heartbeat_interval_hours: 4
    heartbeat_idle_sec: 3600  # æ— æˆäº¤å¿ƒè·³é˜ˆå€¼ï¼ˆç§’ï¼‰

    # é™é»˜æ¨¡å¼ï¼ˆé˜²åˆ·å±ï¼‰
    silent_mode: true         # æˆäº¤åˆå¹¶
    merge_fill_window_sec: 5  # æˆäº¤åˆå¹¶çª—å£ï¼ˆç§’ï¼‰
    min_notify_interval_sec: 5  # åŒç±»é€šçŸ¥æœ€å°é—´éš”ï¼ˆç§’ï¼‰
